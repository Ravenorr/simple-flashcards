<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Flashcards IADE & Co</title>
    
    <link rel="icon" type="image/png" href="favicon.png">
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600&display=swap" rel="stylesheet">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/PapaParse/5.3.0/papaparse.min.js"></script>

    <script>
        window.MathJax = {
            tex: { inlineMath: [['$', '$'], ['\\(', '\\)']] }
        };
    </script>
    <script id="MathJax-script" async src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>

    <style>
        :root {
            --primary: #6c5ce7;
            --secondary: #a29bfe;
            --bg: #dfe6e9;
            --card-bg: #ffffff;
            --text: #2d3436;
            
            /* Couleurs d'√©valuation */
            --success-border: #00b894;
            --success-bg: #55efc4;
            --warning-border: #e17055;
            --warning-bg: #fab1a0;
        }

        body {
            font-family: 'Poppins', sans-serif;
            background-color: var(--bg);
            display: flex;
            flex-direction: column;
            align-items: center;
            padding: 20px;
            margin: 0;
            color: var(--text);
        }

        h1 { margin-bottom: 30px; text-align: center;}

        /* --- Contr√¥les --- */
        .controls-wrapper {
            background: white;
            padding: 20px 30px;
            border-radius: 20px;
            box-shadow: 0 4px 15px rgba(0,0,0,0.05);
            margin-bottom: 40px;
            width: 100%;
            max-width: 800px;
            display: flex;
            flex-direction: column;
            gap: 20px;
            align-items: center;
        }

        .select-group {
            display: flex;
            gap: 15px;
            flex-wrap: wrap;
            justify-content: center;
            width: 100%;
        }

        select {
            padding: 10px 15px;
            border-radius: 10px;
            border: 2px solid var(--secondary);
            background: white;
            font-family: inherit;
            font-size: 1rem;
            color: var(--text);
            cursor: pointer;
            outline: none;
        }

        button.action-btn {
            background-color: var(--primary);
            color: white;
            border: none;
            padding: 12px 25px;
            border-radius: 10px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s;
        }
        button.action-btn:hover { background-color: #5649c0; transform: translateY(-2px); }

        /* Bouton filtre sp√©cial */
        #filterBtn {
            background-color: #636e72;
        }
        #filterBtn.active {
            background-color: var(--warning-border); /* Devient orange quand actif */
            box-shadow: inset 0 0 10px rgba(0,0,0,0.2);
        }

        /* --- Cartes --- */
        #cards-container {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
            gap: 30px;
            width: 100%;
            max-width: 1200px;
        }

        .scene {
            width: 100%;
            height: 300px; /* Un peu plus haut pour caser les boutons */
            perspective: 1000px;
            cursor: pointer;
        }

        .card {
            width: 100%;
            height: 100%;
            position: relative;
            transition: transform 0.6s;
            transform-style: preserve-3d;
            box-shadow: 0 10px 20px rgba(0,0,0,0.1);
            border-radius: 15px;
            border: 3px solid transparent; /* Bordure invisible par d√©faut */
        }

        /* --- √âtats de validation (Vert / Orange) --- */
        .card.is-correct .card__face--front { border-bottom-color: var(--success-border); }
        .card.is-correct { border-color: var(--success-border); }
        .card.is-correct .card__face--back { background-color: var(--success-border); }

        .card.is-wrong .card__face--front { border-bottom-color: var(--warning-border); }
        .card.is-wrong { border-color: var(--warning-border); }
        .card.is-wrong .card__face--back { background-color: var(--warning-border); }


        .card.is-flipped { transform: rotateY(180deg); }

        .card__face {
            position: absolute;
            width: 100%;
            height: 100%;
            -webkit-backface-visibility: hidden;
            backface-visibility: hidden;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center; /* Centre verticalement */
            padding: 10px 15px;
            box-sizing: border-box;
            text-align: center;
            border-radius: 12px; /* Un peu moins que la card pour laisser la bordure visible */
            font-size: 1.1rem;
            overflow-y: auto;
            hyphens: none;
            -webkit-hyphens: none;
            word-break: normal;
            overflow-wrap: break-word;
        }

        .card__face--front {
            background-color: var(--card-bg);
            border-bottom: 5px solid var(--primary);
            z-index: 2;
        }

        .card__face--back {
            background-color: var(--primary);
            color: white;
            transform: rotateY(180deg);
            z-index: 1;
            /* Flex layout sp√©cifique pour le dos */
            justify-content: space-between; 
            padding-bottom: 10px;
        }

        /* Contenu de la r√©ponse (pour qu'il prenne la place au milieu) */
        .back-content {
            flex-grow: 1;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            width: 100%;
        }

        .mini-question {
            font-size: 0.8rem;
            opacity: 0.8;
            margin-bottom: 15px;
            font-style: italic;
            border-bottom: 1px solid rgba(255,255,255,0.3);
            padding-bottom: 5px;
            width: 80%;
        }

        .answer-text { font-size: 1.1rem; font-weight: bold; }

        /* --- Boutons d'√©valuation --- */
        .eval-buttons {
            display: flex;
            gap: 10px;
            margin-top: 10px;
            width: 100%;
            justify-content: center;
        }

        .btn-eval {
            border: none;
            padding: 8px 15px;
            border-radius: 20px;
            font-weight: bold;
            font-size: 0.8rem;
            cursor: pointer;
            transition: transform 0.1s;
            box-shadow: 0 2px 5px rgba(0,0,0,0.2);
        }
        .btn-eval:active { transform: scale(0.95); }

        .btn-wrong { background-color: #ffeaa7; color: #d35400; }
        .btn-correct { background-color: #55efc4; color: #006266; }

        .card-counter {
            position: absolute;
            bottom: 5px;
            right: 10px;
            font-size: 0.7rem;
            opacity: 0.7;
        }

        /* Classes utilitaires pour MathJax */
        mjx-container[display="true"] { display: inline !important; margin: 0 !important; }
    </style>
</head>
<body>

    <h1>üß† R√©visions IADE</h1>

    <div class="controls-wrapper">
        <div class="select-group">
            <select id="categorySelect"><option value="" disabled selected>üìÅ Dossier</option></select>
            <select id="fileSelect" disabled><option value="" disabled selected>üìÑ Sujet</option></select>
            <button id="loadBtn" class="action-btn">Charger</button>
        </div>

        <div style="display: flex; gap: 15px; align-items: center;">
             <button id="filterBtn" class="action-btn" style="display:none;">üëÅÔ∏è Voir seulement les erreurs</button>
            
            <label for="csvFileInput" class="custom-file-upload" style="font-size:0.8rem; text-decoration: underline; cursor:pointer;">
                ou charger un fichier local
            </label>
            <input type="file" id="csvFileInput" accept=".csv" />
        </div>
    </div>

    <div id="cards-container"></div>

    <script>
        // CONFIGURATION
        const AVAILABLE_DECKS = {
            "IADE": ["Anatomie.csv", "Pharmacologie.csv", "Urgences.csv"],
            "Anglais": ["Vocabulaire_Medical.csv"]
        };

        const container = document.getElementById('cards-container');
        const filterBtn = document.getElementById('filterBtn');
        let isFilterActive = false;

        // --- Initialisation Menus (identique avant) ---
        const categorySelect = document.getElementById('categorySelect');
        const fileSelect = document.getElementById('fileSelect');
        
        Object.keys(AVAILABLE_DECKS).forEach(cat => {
            const opt = document.createElement('option');
            opt.value = cat; opt.textContent = cat;
            categorySelect.appendChild(opt);
        });

        categorySelect.addEventListener('change', () => {
            fileSelect.innerHTML = '<option value="" disabled selected>üìÑ Sujet</option>';
            fileSelect.disabled = false;
            AVAILABLE_DECKS[categorySelect.value].forEach(f => {
                const opt = document.createElement('option');
                opt.value = f; opt.textContent = f.replace('.csv', '').replace(/_/g, ' ');
                fileSelect.appendChild(opt);
            });
        });

        // Chargement
        document.getElementById('loadBtn').addEventListener('click', () => {
            const path = `datas/${categorySelect.value}/${fileSelect.value}`;
            if(categorySelect.value && fileSelect.value) loadCSV(path);
        });

        document.getElementById('csvFileInput').addEventListener('change', (e) => {
            if(e.target.files[0]) Papa.parse(e.target.files[0], { complete: res => generateCards(res.data), header: false, skipEmptyLines: true });
        });

        function loadCSV(path) {
            Papa.parse(path, {
                download: true,
                complete: res => generateCards(res.data),
                error: () => alert("Erreur chargement fichier"),
                header: false, skipEmptyLines: true
            });
        }

        // --- GESTION DU FILTRE ---
        filterBtn.addEventListener('click', () => {
            isFilterActive = !isFilterActive;
            
            if (isFilterActive) {
                filterBtn.classList.add('active');
                filterBtn.textContent = "‚ùå Afficher tout";
                applyFilter();
            } else {
                filterBtn.classList.remove('active');
                filterBtn.textContent = "üëÅÔ∏è Voir seulement les erreurs";
                resetFilter();
            }
        });

        function applyFilter() {
            const cards = document.querySelectorAll('.scene');
            cards.forEach(scene => {
                const card = scene.querySelector('.card');
                // Si la carte est marqu√©e "correcte", on cache la sc√®ne enti√®re
                if (card.classList.contains('is-correct')) {
                    scene.style.display = 'none';
                } else {
                    scene.style.display = 'block';
                }
            });
        }

        function resetFilter() {
            const cards = document.querySelectorAll('.scene');
            cards.forEach(scene => scene.style.display = 'block');
        }


        // --- G√âN√âRATION DES CARTES ---
        function generateCards(data) {
            container.innerHTML = '';
            // Reset du filtre quand on charge un nouveau jeu
            isFilterActive = false;
            filterBtn.classList.remove('active');
            filterBtn.textContent = "üëÅÔ∏è Voir seulement les erreurs";
            filterBtn.style.display = 'block'; // On affiche le bouton filtre

            const validData = data.filter(row => row.length >= 2);

            validData.forEach((row, index) => {
                const question = row[0];
                const answer = row[1];
                const counterText = `${index + 1} / ${validData.length}`;

                const scene = document.createElement('div');
                scene.className = 'scene';
                
                const card = document.createElement('div');
                card.className = 'card';

                // FACE AVANT
                const front = document.createElement('div');
                front.className = 'card__face card__face--front';
                front.innerHTML = `${question} <span class="card-counter">${counterText}</span>`;

                // FACE ARRIERE
                const back = document.createElement('div');
                back.className = 'card__face card__face--back';
                
                // On structure le dos : Contenu en haut/milieu, Boutons en bas
                back.innerHTML = `
                    <div class="back-content">
                        <div class="mini-question">${question}</div>
                        <div class="answer-text">${answer}</div>
                    </div>
                    
                    <div class="eval-buttons">
                        <button class="btn-eval btn-wrong">Revoir üü†</button>
                        <button class="btn-eval btn-correct">Compris üü¢</button>
                    </div>
                    
                    <span class="card-counter">${counterText}</span>
                `;

                card.appendChild(front);
                card.appendChild(back);
                scene.appendChild(card);
                container.appendChild(scene);

                // LOGIQUE CLIC CARTE (Flip)
                scene.addEventListener('click', (e) => {
                    // Si on clique sur un bouton, on ne retourne pas la carte !
                    if (e.target.tagName === 'BUTTON') return;
                    card.classList.toggle('is-flipped');
                });

                // LOGIQUE BOUTONS EVALUATION
                const btnCorrect = back.querySelector('.btn-correct');
                const btnWrong = back.querySelector('.btn-wrong');

                btnCorrect.addEventListener('click', (e) => {
                    e.stopPropagation(); // Emp√™che le flip
                    card.classList.remove('is-wrong');
                    card.classList.add('is-correct');
                    // Si le filtre est actif, cette carte doit dispara√Ætre
                    if(isFilterActive) scene.style.display = 'none';
                });

                btnWrong.addEventListener('click', (e) => {
                    e.stopPropagation();
                    card.classList.remove('is-correct');
                    card.classList.add('is-wrong');
                });
            });

            if (window.MathJax) MathJax.typesetPromise();
        }
    </script>
</body>
</html>
